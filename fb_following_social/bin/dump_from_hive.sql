insert overwrite directory 's3a://pm-hdfs2/user/wangcong/fb_following_social/user_media/20211115' row format delimited fields terminated by ',' SELECT userid, CONCAT_WS('|', COLLECT_SET(DISTINCT(media_id))) FROM (SELECT userid, CONCAT('f_', single_like) AS pageid FROM (SELECT userid, likes FROM fb_profile.parquet_fb_user) AS user_likes LATERAL VIEW EXPLODE(user_likes.likes) t AS single_like) AS user_page JOIN fb_profile.local_life_pages_parquet AS local_life_pages ON user_page.pageid = local_life_pages.id AND local_life_pages.media_id IS NOT NULL GROUP BY userid;
